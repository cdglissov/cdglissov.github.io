---
import { getCollection } from 'astro:content';
import { FaEnvelope, FaGithub, FaLinkedin } from 'react-icons/fa6';
import Footer from '@/components/Footer.astro';
import MotionReveal from '@/components/MotionReveal';
import SectionHeading from '@/components/SectionHeading.astro';
import SiteHeader from '@/components/SiteHeader.astro';
import TypedText from '@/components/TypedText';
import { aboutExperience, aboutParagraphs, learningTimeline, projects } from '@/data/content';
import { personSchema, siteConfig } from '@/data/site';
import { formatDate } from '@/utils/format';
import BaseLayout from '@/layouts/BaseLayout.astro';

const featuredPosts = (
  await getCollection('blog', (entry) => !entry.data.draft && entry.data.featured)
)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);

const collapsedTimelineCount = 5;
const hasCollapsedTimeline = learningTimeline.length > collapsedTimelineCount;
const visibleLearningTimeline = hasCollapsedTimeline
  ? learningTimeline.slice(0, collapsedTimelineCount)
  : learningTimeline;
const hiddenLearningTimeline = hasCollapsedTimeline
  ? learningTimeline.slice(collapsedTimelineCount)
  : [];
---

<BaseLayout
  title="Christian D. Glissov | Senior AI Specialist"
  description="Portfolio, experience, projects, and writing by Christian D. Glissov."
  path="/"
  showBackdrop
  structuredData={personSchema}
>
  <SiteHeader />
  <main id="content" class="pb-16 pt-10 md:pt-14">
    <section class="section-shell mb-10">
      <p class="mono kicker mb-3 text-xs uppercase tracking-[0.2em]">Portfolio</p>
      <h1 class="text-3xl font-semibold tracking-tight text-slate-100 md:text-5xl">
        {siteConfig.name}
      </h1>
      <p class="mt-3 text-lg text-slate-200 md:text-xl">
        <TypedText client:idle className="font-medium" phrases={siteConfig.heroPhrases} />
      </p>
      <p class="mt-4 max-w-2xl text-sm text-muted md:text-base">
        {siteConfig.shortBio}
      </p>
      <div class="mt-6 flex flex-wrap items-center gap-3">
        <a class="action-link" href={siteConfig.linkedinUrl} target="_blank" rel="noreferrer">
          <FaLinkedin aria-hidden="true" />
          LinkedIn
        </a>
        <a class="action-link" href={siteConfig.githubUrl} target="_blank" rel="noreferrer">
          <FaGithub aria-hidden="true" />
          GitHub
        </a>
        <a class="action-link" href="#contact">
          <FaEnvelope aria-hidden="true" />
          Email
        </a>
      </div>
    </section>

    <MotionReveal client:visible className="mb-10">
      <section id="about" class="section-shell">
        <SectionHeading
          kicker="About"
          title="I am Christian."
          subtitle="I live in Copenhagen, where I create autonomous systems."
        />
        <div class="grid gap-8 lg:grid-cols-[minmax(0,1fr)_minmax(16.5rem,20rem)]">
          <div class="max-w-[68ch] space-y-4 text-sm text-slate-300 md:text-base">
            {aboutParagraphs.map((paragraph) => <p class="leading-7" set:html={paragraph} />)}
          </div>
          <aside
            class="h-fit rounded-xl border border-border bg-white/5 p-4 lg:mt-1"
            aria-label="Experience summary"
          >
            <ul>
              {
                aboutExperience.map((entry, index) => {
                  const previousEntry = index > 0 ? aboutExperience[index - 1] : undefined;
                  const isSectionTransition = previousEntry && previousEntry.type !== entry.type;

                  const logoSrc =
                    entry.type === 'education'
                      ? '/logo_dtu.png'
                      : entry.place.toLowerCase().includes('netcompany')
                        ? '/logo_nc.png'
                        : '/logo_if.png';
                  const logoAlt =
                    entry.type === 'education'
                      ? 'DTU logo'
                      : entry.place.toLowerCase().includes('netcompany')
                        ? 'Netcompany logo'
                        : 'If logo';

                  return (
                    <li
                      class:list={[
                        'space-y-1.5 py-3 first:pt-0 last:pb-0',
                        isSectionTransition && 'mt-2 border-t border-border pt-5'
                      ]}
                    >
                      <p class="flex items-start gap-3 text-xs text-muted">
                        <span class="min-w-0 flex-1">{entry.place}</span>
                        <span class="mono ml-auto shrink-0 whitespace-nowrap text-[0.68rem] uppercase tracking-[0.12em]">
                          {entry.period}
                        </span>
                      </p>
                      <p class="flex items-center gap-2.5 text-sm text-slate-100">
                        <img
                          src={logoSrc}
                          alt={logoAlt}
                          class="h-4 w-4 rounded-sm object-contain"
                          loading="eager"
                        />
                        <span>{entry.label}</span>
                      </p>
                    </li>
                  );
                })
              }
            </ul>
          </aside>
        </div>
      </section>
    </MotionReveal>

    <MotionReveal client:visible className="mb-10" delay={0.12}>
      <section id="projects" class="section-shell">
        <SectionHeading kicker="Projects" title="Things I've built" />
        <div class="grid gap-4 md:grid-cols-2">
          {
            projects.map((project) => (
              <a class="card-link group" href={project.href} target="_blank" rel="noreferrer">
                <article class="card-lift card-shell flex h-full flex-col rounded-xl p-5">
                  <h3 class="card-title text-base font-semibold">{project.name}</h3>
                  <p class="mt-2 text-sm text-muted">{project.description}</p>
                  <ul class="mt-4 flex flex-wrap gap-2">
                    {project.stack.map((tech) => (
                      <li class="tag">{tech}</li>
                    ))}
                  </ul>
                </article>
              </a>
            ))
          }
        </div>
      </section>
    </MotionReveal>

    <MotionReveal client:visible className="mb-10" delay={0.1}>
      <section id="learning" class="section-shell">
        <SectionHeading
          kicker="Learning"
          title="Milestones"
          subtitle="A snapshot of what I have been exploring and leveling up in."
        />
        <div class="timeline-list">
          {
            visibleLearningTimeline.map((entry) => (
              <article class="timeline-entry">
                <p class="timeline-date mono">{entry.period}</p>
                <div class="timeline-content">
                  <h3 class="timeline-topic">{entry.topic}</h3>
                  <p class="timeline-description">{entry.description}</p>
                </div>
              </article>
            ))
          }
        </div>
        {
          hasCollapsedTimeline && (
            <details class="timeline-more">
              <summary class="timeline-toggle">
                <span class="timeline-toggle-closed">
                  Show {hiddenLearningTimeline.length} more
                </span>
                <span class="timeline-toggle-open">Show less</span>
              </summary>
              <div class="timeline-list timeline-list-extra">
                {hiddenLearningTimeline.map((entry) => (
                  <article class="timeline-entry">
                    <p class="timeline-date mono">{entry.period}</p>
                    <div class="timeline-content">
                      <h3 class="timeline-topic">{entry.topic}</h3>
                      <p class="timeline-description">{entry.description}</p>
                    </div>
                  </article>
                ))}
              </div>
            </details>
          )
        }
      </section>
    </MotionReveal>

    <MotionReveal client:visible className="mb-10" delay={0.15}>
      <section class="section-shell">
        <SectionHeading
          kicker="Featured Writing"
          title="Recent notes from the blog"
          subtitle="A running log of what has caught my interest."
        />
        <div class="grid gap-4 md:grid-cols-3">
          {
            featuredPosts.map((post) => (
              <a class="card-link group" href={`/blog/${post.slug}/`}>
                <article class="card-lift card-shell h-full rounded-xl p-4">
                  <p class="mono text-xs uppercase tracking-wide text-muted">
                    {formatDate(post.data.pubDate)}
                  </p>
                  <h3 class="card-title mt-2 text-base font-semibold">{post.data.title}</h3>
                  <p class="mt-2 text-sm text-muted">{post.data.description}</p>
                  <ul class="mt-3 flex flex-wrap gap-2">
                    {post.data.tags.map((tag) => (
                      <li class="tag">{tag}</li>
                    ))}
                  </ul>
                </article>
              </a>
            ))
          }
        </div>
        <a
          class="mt-6 inline-block text-sm text-accent underline-offset-4 hover:underline"
          href="/blog/"
        >
          Browse all posts
        </a>
      </section>
    </MotionReveal>

    <MotionReveal client:visible delay={0.18}>
      <section id="contact" class="section-shell">
        <SectionHeading
          kicker="Contact"
          title="Let's talk"
          subtitle="If you're building something interesting, I'd love to hear about it."
        />
        <form action={siteConfig.formspreeUrl} class="grid gap-4" method="POST">
          <label class="form-field">
            <span class="text-muted">Name</span>
            <input class="form-control" type="text" name="name" required />
          </label>
          <label class="form-field">
            <span class="text-muted">Email</span>
            <input class="form-control" type="email" name="email" required />
          </label>
          <label class="form-field">
            <span class="text-muted">Message</span>
            <textarea class="form-control form-control-textarea" name="message" required></textarea>
          </label>
          <button type="submit" class="form-submit w-fit">Send message</button>
        </form>
      </section>
    </MotionReveal>
  </main>
  <Footer />
</BaseLayout>
