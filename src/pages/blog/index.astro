---
import { getCollection } from 'astro:content';
import Footer from '@/components/Footer.astro';
import SectionHeading from '@/components/SectionHeading.astro';
import SiteHeader from '@/components/SiteHeader.astro';
import BaseLayout from '@/layouts/BaseLayout.astro';
import { formatDate, slugifyTag } from '@/utils/format';

const posts = (await getCollection('blog', (entry) => !entry.data.draft)).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

const tags = Array.from(new Set(posts.flatMap((post) => post.data.tags))).sort((a, b) => a.localeCompare(b));
---

<BaseLayout
  title="Blog | Christian D. Glissov"
  description="Notes on AI systems, evaluation, and scientific computing."
  path="/blog/"
>
  <SiteHeader />
  <main id="content" class="pb-16 pt-10 md:pt-14">
    <section class="section-shell">
      <SectionHeading
        kicker="Blog"
        title="Practical AI engineering notes"
        subtitle="Math-first thinking, production tradeoffs, and implementation details."
      />
      <div class="mb-6 flex flex-wrap gap-2">
        <a class="tag border-accent text-accent" href="/blog/">All</a>
        {tags.map((tag) => <a class="tag" href={`/blog/tag/${slugifyTag(tag)}/`}>{tag}</a>)}
      </div>
      <div class="space-y-4">
        {
          posts.map((post) => (
            <article class="rounded-xl border border-border bg-white/5 p-5">
              <p class="mono text-xs uppercase tracking-wide text-muted">{formatDate(post.data.pubDate)}</p>
              <h2 class="mt-2 text-xl font-semibold text-slate-100">
                <a class="hover:text-accent" href={`/blog/${post.slug}/`}>
                  {post.data.title}
                </a>
              </h2>
              <p class="mt-2 text-sm text-muted">{post.data.description}</p>
              <ul class="mt-3 flex flex-wrap gap-2">
                {post.data.tags.map((tag) => <li class="tag">{tag}</li>)}
              </ul>
            </article>
          ))
        }
      </div>
    </section>
  </main>
  <Footer />
</BaseLayout>
