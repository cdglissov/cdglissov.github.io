---
import { getCollection } from 'astro:content';
import Footer from '@/components/Footer.astro';
import SiteHeader from '@/components/SiteHeader.astro';
import BaseLayout from '@/layouts/BaseLayout.astro';
import { formatDate } from '@/utils/format';

type BlogEntry = Awaited<ReturnType<typeof getCollection<'blog'>>>[number];

type Props = {
  post: BlogEntry;
};

export async function getStaticPaths() {
  const posts = await getCollection('blog', (entry) => !entry.data.draft);

  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post }
  }));
}

const { post } = Astro.props as Props;
const { Content } = await post.render();
---

<BaseLayout
  title={`${post.data.title} | Christian D. Glissov`}
  description={post.data.description}
  path={`/blog/${post.slug}/`}
>
  <SiteHeader />
  <main id="content" class="pb-16 pt-10 md:pt-14">
    <article class="section-shell mx-auto w-[min(860px,92vw)]">
      <p class="mono text-xs uppercase tracking-wide text-muted">
        {formatDate(post.data.pubDate)}
      </p>
      <h1 class="mt-2 text-3xl font-semibold tracking-tight text-slate-100">
        {post.data.title}
      </h1>
      <p class="mt-3 text-base text-muted">{post.data.description}</p>
      <ul class="mt-4 flex flex-wrap gap-2">
        {post.data.tags.map((tag) => <li class="tag">{tag}</li>)}
      </ul>
      <div class="prose prose-invert mt-8 max-w-none">
        <Content />
      </div>
    </article>
  </main>
  <Footer />
</BaseLayout>
